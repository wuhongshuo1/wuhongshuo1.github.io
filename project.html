<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Project</title>
</head>

<body>
	<p id=element> 试试 </p>
	<script src="chart.min.js"> //引入Chart.js
	Chart.defaults.global.responsive = true; //默认开启图表响应
	</script>
	<script src="jquery-3.6.0.min.js"> //引入jquery.js
	</script>
	
		
	<script>
	function loadXMLDoc(dname)
{
    if (window.XMLHttpRequest)
    {
        xhttp=new XMLHttpRequest();
    }
    else
    {
        xhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xhttp.open("GET",dname,false);
    xhttp.send();
    return xhttp.responseXML;
}
	</script>
	<canvas id="myChart" width="400" height="400"></canvas> <!--声明图表大小-->
	
	<script>
		xmlDoc=loadXMLDoc("dataBase.xml");
		function test(){
			document.getElementById("element").innerHTML=xmlDoc.getElementsByTagName("Hour")[0].childNodes[0].nodeValue;
		};
	var news ={newsID:0,newsName:"",newsDate:"",newsTime:"",newsHot:"",newsRank:0};
	var chartData = { //定义图表数据
    type: 'bar',
    data: {
        labels: [],
        datasets: [{
        	label: 'Dataset1',
            data: [],
			fillColor: "rgba(0,60,100,1)",
			backgroundColor:"rgba(0,60,100,1)",
            borderWidth: 1,
            order: 1,
            yAxisID:'y',
        },
        {
        	label: "Dataset2",
        	data:[],
        	fillColor: "rgba(0,60,100,1)",
			backgroundColor:"rgba(0,60,100,1)",
            borderWidth: 1,
            type: 'line',
            order: 0,
            yAxisID: 'y1',
        }
        ],
    },
    options: {
        scales: {
        	y:{
        		display: true,
        		position: 'left',
        	},
        	y1: {
        		type:'linear',
        		display: true,
        		position: 'right',
        		reverse: true,
        	},
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        },
        plugins: {
        	title: {
        		display: true,
        		text: '首页',
        	}
        }
    }
	};
	var ctx = document.getElementById("myChart");
	var myChart = new Chart(ctx,chartData,{responsive:true});
	var index =11;
	function addData(chart, set, label, data_) {
		if (set==0)
		{
			chart.data.labels.push(label);
		}
    	chart.data.datasets[set].data.push(data_);
		index++;
    	chart.update();
	};

	function removeData(chart) {
		chart.data.labels.pop();
    	chart.data.datasets.forEach((dataset) => {
        	dataset.data.pop();
    	});
    	chart.update();
	};
	function setup(date,hour)
		{
			while (myChart.data.datasets[0].data.length)
			{
				removeData(myChart);
			}
			for (var i=0;i<7;i++)
				{
					var a=xmlDoc.getElementsByTagName("NewsDate")[date].getElementsByTagName("Name")[i];
					for (var j=0;j<a.getElementsByTagName("Hour").length;j++)
					{
						if (a.getElementsByTagName("Hour")[j].childNodes[0].nodeValue==hour)
						{
							addData(myChart,0,a.childNodes[0].nodeValue,
								a.getElementsByTagName("Hot")[j].childNodes[0].nodeValue);
							addData(myChart,1,a.childNodes[0].nodeValue,
								a.getElementsByTagName("Rank")[j].childNodes[0].nodeValue);
							myChart.options.plugins.title.text=(date+'的'+hour+'点的热搜排行');
						}
					}
				}
		};
	</script>
	<button id=setupButton onClick="setup(document.getElementById('DateList').selectedIndex,
		document.getElementById('HourList').selectedIndex)">setup</button>
	<button onClick="removeData(myChart)">删除</button>
	<select id="DateList">
		<option id="5/1" value=0 selected=true>5/1</option>
		<option id="5/2" value=1>5/2</option>
	</select>
	<select id="HourList">
	</select>
	<script>
		
		for (i=0;i<24;i++)
		{
			var option=document.createElement("option");
			if (i=0)
			{
				option.selected=true;
			}
			option.id=('h'+i);
			option.value=i;
			option.text=(i+'点');
			document.getElementById('HourList').add(option,null);
		}
	</script>
</body>
</html>
